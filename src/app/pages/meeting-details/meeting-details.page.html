<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      {{groupname}}
    </ion-title>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/app/tabs/groups/{{groupid}}"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
  <ion-list lines="none" class="info-header">
    <ion-item>
      <ion-label>
        <h2>{{'meeting' | translate}}: <strong>{{meetingplace}}</strong></h2>
      </ion-label>
      <ion-note slot="end"><strong>{{meetingdate}}</strong></ion-note>
    </ion-item>
    <ion-item>
      <ion-icon size="large" name="information-circle-outline"></ion-icon>
      <div class="ion-padding-start">
        <ion-note>{{'new_transactions_info' | translate}}</ion-note>
      </div>
    </ion-item>
    <ion-item>
      <ion-label>
        <ion-text color="secondary">
          <h6>{{'cash' | translate}}</h6>
        </ion-text>
      </ion-label>
      <ion-badge  color="success">{{new_totals.cash | number:'.2'}}</ion-badge>
      &nbsp;
      <ion-label>
        <ion-text color="secondary">
          <h6>{{'balance' | translate}}</h6>
        </ion-text>
      </ion-label>
      <ion-badge  color="success">{{new_totals.balance | number:'.2'}}</ion-badge>
      &nbsp;
      <ion-label>
        <ion-text color="secondary">
          <h6>{{'credit_av' | translate}}</h6>
        </ion-text>
      </ion-label>
      <ion-badge  color="success">{{new_totals.credit | number:'.2'}}</ion-badge>
    </ion-item>
  </ion-list>
</ion-header>

<ion-content class="ion-padding">
  
  <div class="summary-card ion-padding">
    <h3 class="serif-text ion-no-margin">{{ summary.title }}</h3>
    
    <ion-grid class="ion-no-padding ion-margin-top">
      <ion-row>
        <ion-col class="ion-text-center">
          <h1 class="stat-value ion-no-margin">{{ summary.collected }}</h1>
          <p class="stat-label ion-text-uppercase">CAD collected</p>
        </ion-col>
        <ion-col class="ion-text-center">
          <h1 class="stat-value ion-no-margin">{{ summary.issued }}</h1>
          <p class="stat-label ion-text-uppercase">Maats issued</p>
        </ion-col>
      </ion-row>

      <ion-row class="ion-margin-top footer-stats">
        <ion-col size="4">
          <span class="mini-label ion-text-uppercase">Closed</span>
          <div class="stat-row">
            <span class="date-box">17</span>
            <span class="small-val">{{ summary.closedDate }}</span>
          </div>
        </ion-col>
        <ion-col size="4">
          <span class="mini-label ion-text-uppercase">Highest Day</span>
          <div class="stat-row">
            <span>üî•</span>
            <span class="small-val">{{ summary.highestDay }} CAD</span>
          </div>
        </ion-col>
        <ion-col size="4">
          <span class="mini-label ion-text-uppercase">Attended</span>
          <div class="stat-row">
            <span>ü§ù</span>
            <span class="small-val">{{ summary.attended }}</span>
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>

  <ion-list class="ion-margin-top" lines="none">
    @for (member of members; track member.name) {
      <ion-item class="member-item ion-margin-bottom">
        
        <ion-avatar slot="start" [class]="'avatar-' + member.status">
           <div class="status-icon"></div>
        </ion-avatar>

        <ion-label>
          <h2 class="member-name">{{ member.name }}</h2>
          @for (warn of member.warnings; track warn) {
            <p class="warning-text">
              <ion-icon [name]="member.icon || 'close-circle'" color="danger"></ion-icon>
              {{ warn }}
            </p>
          }
        </ion-label>

        <div slot="end" class="badge-container">
          @if (member.maat) {
            <div class="custom-badge maat-badge">
              <span class="val">{{ member.maat }}</span>
              <span class="lab">Maat</span>
            </div>
          }
          @if (member.balance) {
            <div class="custom-badge balance-badge">
              <span class="val">{{ member.balance }}</span>
              <span class="lab">Balance</span>
            </div>
          }
        </div>

      </ion-item>
    }
  </ion-list>
</ion-content>

<!-- <ion-content [fullscreen]="false">
  <ion-item>
    <ion-button class="ion-float-left" [fill]="selectedAll ? 'solid' : 'outline'" color="tertiary" shape="round" (click)="selectAll()">{{'all' | translate}}</ion-button>
    @if (selectedAccounts) {
      <ion-text class="ion-margin-left" color="secondary">&nbsp;({{selectedAccounts}}) selected</ion-text>
    }
    <ion-button [disabled]="selectedAccounts ? false : true" class="ion-float-right" slot="end" size="small" color="secondary" (click)="addTransactionModal($event, null)"><ion-icon name="add"></ion-icon></ion-button>
  </ion-item>
  <ion-list>
    @for (account of accounts; track account) {
      <ion-item [ngStyle]="{'--background': account.selected ? '#f5f5f5' : '', 'border-left': account.selected ? '5px solid #8ec8c2' : ''}"
        (click)="selectAccount(account)">
        <ion-label>
          <ion-text [color]="account.type == 1 ? '' : 'primary'">
            <h2>
              @if (account.type != 1) {
                <ion-icon name="people"></ion-icon>
              }
              @if (account.type == 1) {
                <ion-text color="primary">({{account.num}}) </ion-text>
                }{{account.owner}}
                <ion-note slot="end">
                  <ion-button class="ion-float-right" size="small" color="success" (click)="showAccountInfo($event, account)">
                    <ion-icon  name="information-outline"></ion-icon>
                  </ion-button>
                  <ion-button [disabled]="meeting.endedat || selectedAccounts" class="ion-float-right" size="small" color="secondary" (click)="addTransactionModal($event, account)"><ion-icon name="add"></ion-icon></ion-button>
                </ion-note>
              </h2>
            </ion-text>
            <ion-note class="sum-info">
              <ion-icon name="arrow-redo" color="success"></ion-icon> {{account.balance | number}}
              <ion-icon name="arrow-undo" color="danger"></ion-icon> {{account.restearembourser | number}} {{currency}}
              @if (account.openloans) {
                <ion-text>({{account.openloans}})</ion-text>
              }
            </ion-note>
            <ion-grid class="transactions ion-no-padding">
              <ion-row>
                <ion-col size="5">
                  <p>
                    {{'credit_disp' | translate}}: <ion-text [color]="account.creditdisponible < 0 ? 'danger':''">{{account.creditdisponible | number}} {{currency}}</ion-text>
                  </p>
                  <p>
                    {{'loan_req' | translate}}: {{account.besoinsliquidite | number}} {{currency}}
                  </p>
                </ion-col>
                <ion-col>
                  @for (tr of account.transactions; track tr) {
                    <ion-item color="light">
                      <div>
                        @if (tr.error) {
                          <ion-note color="danger"><ion-icon name="warning"></ion-icon> {{tr.error}}</ion-note>
                        }
                        <p>
                          {{tr.parametername}}: <strong>{{tr.amount | number:'.2'}}</strong>
                        </p>
                      </div>
                      <ion-button [disabled]="meeting.endedat" size="small" color="danger" slot="end" (click)="deleleTransaction($event, tr)"><ion-icon name="close"></ion-icon></ion-button>
                    </ion-item>
                  }
                </ion-col>
              </ion-row>
            </ion-grid>
          </ion-label>
        </ion-item>
      }
    </ion-list>
  </ion-content>-->
